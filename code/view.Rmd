---
output: html_document
---

```{r, include=FALSE}
library(magrittr)
library(knitr)
library(sp)
library(mapview)
library(glue)
opts_chunk$set(
  echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, #fig.width = 9, fig.height = 9, 
  results = 'hide', out.width = '100%', out.height = '100vh')
```

```{r}
load('../data/obs.rda')
load("../data/sheets_keys.rda")
```

```{r}
obs <- lapply(1:nrow(sheets_keys), function (i) 
  data.frame(
    obs[[i]][c("observacao_id", "coord_x", "coord_y")], id = sheets_keys$ctb[i], stringsAsFactors = FALSE))
febr <- do.call(rbind, obs) %>% na.exclude()
febr$observacao_id <- glue("{febr$observacao_id}@{febr$id}")
```

```{r}
febr$id <- glue('<a href="http://www.ufsm.br/febr/catalog/{febr$id}.html" target="_blank">Mais informações</a>')
```

```{r}
coordinates(febr) <- c("coord_x", "coord_y")
proj4string(febr) <- CRS("+init=epsg:4674")
```

```{r, results='asis'}
logo <- 'logo.svg'
mapview(
  febr, label = febr$observacao_id, popup = glue('{febr$id}', sep = ""), 
  col.regions = "firebrick1", lwd = 1, col = "ivory") %>% 
  addLogo(img = logo, url = "http://www.ufsm.br/febr/")
```
